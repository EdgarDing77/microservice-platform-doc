# 单点登录

## Intorduction

「What」**单点登录**（Single sign-on，SSO）一种对于许多相互关连，但是又相互独立的软件系统，提供访问控制的属性。当拥有这项属性时，但用户登录时，就可以获取所有系统的访问权限，不用对每一个单一系统都逐一登录。这项功能通常以**LDAP**（[轻型目录访问协议](https://zh.wikipedia.org/wiki/轻型目录访问协议)）来实现，在服务器上会将用户信息存储到LDAP数据库中。相同的，**单一退出**（single sign-off）就是指，只需要单一的退出动作，就可以结束对于多个系统的访问权限。

## 基本原理

SSO基于共享**uaa授权中心**和**Cookie**来实现，大致流程如下：

1. 但系统A登录成功
2. uaa授权中心会保存系统A中的登录信息建立全局会话，并把自己的cookie写到用户的浏览器中
3. 当同一个浏览器访问系统B时，跳转到uua授权中心时会吧浏览器中的uaa和cookie也带过去
4. uaa授权中心根据自己的cookie判断浏览器的用户已登录过，从而进行自动登录完成单点登录

**单点时序图：![sso时序图](https://cdn.jsdelivr.net/gh/edgarding77/microservice-platform-doc@latest/image/func/sso%E6%97%B6%E5%BA%8F%E5%9B%BE.jpg)**

## 具体流程

[todo]之后通过浏览器进行分析



## 实现

基于Spring Security实现：[todo]

```java
```

最简单的方式就是使用`Spring Security`的`@EnableOAuth2Sso注解`，该注解会自动添加一个认证过滤器，自动完成`授权码模式`的oauth2授权流程



## Reference

- wiki：https://en.wikipedia.org/wiki/Single_sign-on
- https://zhuanlan.zhihu.com/p/66037342
- 