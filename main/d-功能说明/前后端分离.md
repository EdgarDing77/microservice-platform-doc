# 前后端分离

## Introduction

前后端分离的核心概念是后端仅返回前端所需的数据，不再渲染HTML页面，前端HTML页面通过AJAX调用后端的RESTful API接口并使用JSON数据进行交互。



**跨域**间的**前后端分离**项目也是基于共享统一授权服务(UAA)的**cookie**来实现**单点登录**的，但是与**非前后分离**不一样的是存在以下问题需要解决

1. 没有过滤器/拦截器，需要在前端判断登录状态
2. 需要自己实现**oauth2**的**授权码模式**交互逻辑
3. 需要解决安全性问题，**oauth2**的**clientSecret**参数放在前端不安全

## 实现架构

![img](https://cdn.jsdelivr.net/gh/edgarding77/microservice-platform-doc@latest/image/func/front-back-arch.png)

> 前端WEB工程有几个点需要注意：
>
> 1. **红色线条**为重定向跳转
> 2. **前端工程**可通过是否存在 `access_token` 判断登录状态
> 3. **前端工程**跳转**UAA**之前需记录用户访问的页面地址，方便登录完成后重定向回去

## 前端设计

### 概念解释

**iframe：**

- 该`<iframe>`标签指定了一个内嵌框架。内嵌框架用于在当前 HTML 文档中嵌入另一个文档。
- 每个嵌入的浏览上下文（embedded browsing context）都有自己的[会话历史记录(session history)](https://developer.mozilla.org/zh-CN/docs/Web/API/History)和[DOM树](https://developer.mozilla.org/zh-CN/docs/Web/API/Document)。包含嵌入内容的浏览上下文称为*父级浏览上下文*。顶级浏览上下文（没有父级）通常是由 [`Window`](https://developer.mozilla.org/zh-CN/docs/Web/API/Window) 对象表示的浏览器窗口。

**layui：**

> layui 是一款采用自身模块规范编写的前端 UI 框架，遵循原生 HTML/CSS/JS 的开发方式，极易上手，拿来即用。其风格简约轻盈，而组件优雅丰盈，从源代码到使用方法的每一处细节都经过精心雕琢，非常适合网页界面的快速开发。layui 区别于那些基于 MVVM 底层的前端框架，却并非逆道而行，而是信奉返璞归真之道。准确地说，它更多是面向后端开发者，你无需涉足前端各种工具，只需面对浏览器本身，让一切你所需要的元素与交互，从这里信手拈来。

这里采用现有的一个模版EasyWeb iframe。

- 方法：layui.data(table, settings)

  参数table为表名，settings是一个对象，用于设置key、value。
  该方法对localStorage进行了良好的封装，在Layui的多个内置模块（比如layim）中发挥了重要的作用，因此你可以使用它存储一些本地数据。

- layer.load(icon, options) - 加载层，详细了解文章《[layer API帮助文档](http://layer.layui.com/api.html)》
  - load并不需要你传太多的参数，但如果你不喜欢默认的加载风格，你还有选择空间。icon支持传入`0-2`如果是0，无需传。另外特别注意一点：`load默认是不会自动关闭的`，因为你一般会在ajax回调体中关闭它。

```javascript
if (window !== top) top.location.replace(location.href);
```

> `**Location**`**`.replace()`** 方法以给定的URL来替换当前的资源。 与[`assign()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Location/assign) 方法 不同的是，调用 `replace()` 方法后，当前页面不会保存到会话历史中（session [`History`](https://developer.mozilla.org/zh-CN/docs/Web/API/History)），这样，用户点击*回退*按钮时，将不会再跳转到该页面。

### Ajax

- xhrFields：因为在默认情况下，跨源请求不提供凭据(cookie、HTTP认证及客户端SSL证明等)。通过将withCredentials属性设置为true，可以指定某个请求应该发送凭据。如果服务器接收带凭据的请求，会用下面的HTTP头部来响应。



## Reference

- layui：2021/10/13 下线了 新地址：https://layui.itze.cn/
  - github：https://github.com/sentsin/layui
  - docs：https://www.layuion.com/doc/
  - learning：https://www.kancloud.cn/hongwei_ui_team/layui/475341
- layui模版：https://github.com/zhongshaofa/layuimini
- EasyWeb：https://eleadmin.com/doc/eleadmin/#/

- iframehttps://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/iframe